"use strict";var exports=module.exports={};
var _from = require('../../babel-runtime/core-js/array/from.js');

var _from2 = _interopRequireDefault2(_from);

var _defineProperty2 = require('../../babel-runtime/core-js/object/define-property.js');

var _defineProperty3 = _interopRequireDefault2(_defineProperty2);

var _assign = require('../../babel-runtime/core-js/object/assign.js');

var _assign2 = _interopRequireDefault2(_assign);

var _isIterable2 = require('../../babel-runtime/core-js/is-iterable.js');

var _isIterable3 = _interopRequireDefault2(_isIterable2);

var _getIterator2 = require('../../babel-runtime/core-js/get-iterator.js');

var _getIterator3 = _interopRequireDefault2(_getIterator2);

function _interopRequireDefault2(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () {
  function sliceIterator(arr, i) {
    var _arr = [];var _n = true;var _d = false;var _e = undefined;try {
      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;_e = err;
    } finally {
      try {
        if (!_n && _i["return"]) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }return _arr;
  }return function (arr, i) {
    if (Array.isArray(arr)) {
      return arr;
    } else if ((0, _isIterable3.default)(Object(arr))) {
      return sliceIterator(arr, i);
    } else {
      throw new TypeError("Invalid attempt to destructure non-iterable instance");
    }
  };
}();

var _extends = _assign2.default || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }return target;
};

exports.default = createActions;

var _identity = require('../../lodash/identity.js');

var _identity2 = _interopRequireDefault(_identity);

var _camelCase = require('../../lodash/camelCase.js');

var _camelCase2 = _interopRequireDefault(_camelCase);

var _isPlainObject = require('../../lodash/isPlainObject.js');

var _isPlainObject2 = _interopRequireDefault(_isPlainObject);

var _isArray = require('../../lodash/isArray.js');

var _isArray2 = _interopRequireDefault(_isArray);

var _reduce = require('../../lodash/reduce.js');

var _reduce2 = _interopRequireDefault(_reduce);

var _isString = require('../../lodash/isString.js');

var _isString2 = _interopRequireDefault(_isString);

var _isFunction = require('../../lodash/isFunction.js');

var _isFunction2 = _interopRequireDefault(_isFunction);

var _createAction = require('./createAction.js');

var _createAction2 = _interopRequireDefault(_createAction);

var _invariant = require('../../invariant/browser.js');

var _invariant2 = _interopRequireDefault(_invariant);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    (0, _defineProperty3.default)(obj, key, { value: value, enumerable: true, configurable: true, writable: true });
  } else {
    obj[key] = value;
  }return obj;
}

function _toConsumableArray(arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }return arr2;
  } else {
    return (0, _from2.default)(arr);
  }
}

function createActions(actionsMap) {
  for (var _len = arguments.length, identityActions = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    identityActions[_key - 1] = arguments[_key];
  }

  (0, _invariant2.default)(identityActions.every(_isString2.default) && ((0, _isString2.default)(actionsMap) || (0, _isPlainObject2.default)(actionsMap)), 'Expected optional object followed by string action types');
  if ((0, _isString2.default)(actionsMap)) {
    return fromIdentityActions([actionsMap].concat(identityActions));
  }
  return _extends({}, fromActionsMap(actionsMap), fromIdentityActions(identityActions));
}

function isValidActionsMapValue(actionsMapValue) {
  if ((0, _isFunction2.default)(actionsMapValue)) {
    return true;
  } else if ((0, _isArray2.default)(actionsMapValue)) {
    var _actionsMapValue = _slicedToArray(actionsMapValue, 2);

    var _actionsMapValue$ = _actionsMapValue[0];
    var payload = _actionsMapValue$ === undefined ? _identity2.default : _actionsMapValue$;
    var meta = _actionsMapValue[1];

    return (0, _isFunction2.default)(payload) && (0, _isFunction2.default)(meta);
  }
  return false;
}

function fromActionsMap(actionsMap) {
  return (0, _reduce2.default)(actionsMap, function (actionCreatorsMap, actionsMapValue, type) {
    (0, _invariant2.default)(isValidActionsMapValue(actionsMapValue), 'Expected function, undefined, or array with payload and meta ' + ('functions for ' + type));
    var actionCreator = (0, _isArray2.default)(actionsMapValue) ? _createAction2.default.apply(undefined, [type].concat(_toConsumableArray(actionsMapValue))) : (0, _createAction2.default)(type, actionsMapValue);

    return _extends({}, actionCreatorsMap, _defineProperty({}, (0, _camelCase2.default)(type), actionCreator));
  }, {});
}

function fromIdentityActions(identityActions) {
  return fromActionsMap(identityActions.reduce(function (actionsMap, actionType) {
    return _extends({}, actionsMap, _defineProperty({}, actionType, _identity2.default));
  }, {}));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUFjdGlvbnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJfc2xpY2VkVG9BcnJheSIsInNsaWNlSXRlcmF0b3IiLCJhcnIiLCJpIiwiX2FyciIsIl9uIiwiX2QiLCJfZSIsInVuZGVmaW5lZCIsIl9pIiwiX3MiLCJuZXh0IiwiZG9uZSIsInB1c2giLCJsZW5ndGgiLCJlcnIiLCJBcnJheSIsImlzQXJyYXkiLCJUeXBlRXJyb3IiLCJfZXh0ZW5kcyIsInRhcmdldCIsImFyZ3VtZW50cyIsInNvdXJjZSIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlZmF1bHQiLCJjcmVhdGVBY3Rpb25zIiwiX2lkZW50aXR5IiwicmVxdWlyZSIsIl9pZGVudGl0eTIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NhbWVsQ2FzZSIsIl9jYW1lbENhc2UyIiwiX2lzUGxhaW5PYmplY3QiLCJfaXNQbGFpbk9iamVjdDIiLCJfaXNBcnJheSIsIl9pc0FycmF5MiIsIl9yZWR1Y2UiLCJfcmVkdWNlMiIsIl9pc1N0cmluZyIsIl9pc1N0cmluZzIiLCJfaXNGdW5jdGlvbiIsIl9pc0Z1bmN0aW9uMiIsIl9jcmVhdGVBY3Rpb24iLCJfY3JlYXRlQWN0aW9uMiIsIl9pbnZhcmlhbnQiLCJfaW52YXJpYW50MiIsIm9iaiIsIl9fZXNNb2R1bGUiLCJfZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIyIiwiYWN0aW9uc01hcCIsIl9sZW4iLCJpZGVudGl0eUFjdGlvbnMiLCJfa2V5IiwiZXZlcnkiLCJmcm9tSWRlbnRpdHlBY3Rpb25zIiwiY29uY2F0IiwiZnJvbUFjdGlvbnNNYXAiLCJpc1ZhbGlkQWN0aW9uc01hcFZhbHVlIiwiYWN0aW9uc01hcFZhbHVlIiwiX2FjdGlvbnNNYXBWYWx1ZSIsIl9hY3Rpb25zTWFwVmFsdWUkIiwicGF5bG9hZCIsIm1ldGEiLCJhY3Rpb25DcmVhdG9yc01hcCIsInR5cGUiLCJhY3Rpb25DcmVhdG9yIiwiYXBwbHkiLCJyZWR1Y2UiLCJhY3Rpb25UeXBlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUFBLE9BQU9DLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxTQUFPO0FBRG9DLENBQTdDOztBQUlBLElBQUlDLGlCQUFpQixZQUFZO0FBQUUsV0FBU0MsYUFBVCxDQUF1QkMsR0FBdkIsRUFBNEJDLENBQTVCLEVBQStCO0FBQUUsUUFBSUMsT0FBTyxFQUFYLENBQWUsSUFBSUMsS0FBSyxJQUFULENBQWUsSUFBSUMsS0FBSyxLQUFULENBQWdCLElBQUlDLEtBQUtDLFNBQVQsQ0FBb0IsSUFBSTtBQUFFLFdBQUssSUFBSUMsZ0NBQUtQLEdBQUwsQ0FBSixFQUFpQ1EsRUFBdEMsRUFBMEMsRUFBRUwsS0FBSyxDQUFDSyxLQUFLRCxHQUFHRSxJQUFILEVBQU4sRUFBaUJDLElBQXhCLENBQTFDLEVBQXlFUCxLQUFLLElBQTlFLEVBQW9GO0FBQUVELGFBQUtTLElBQUwsQ0FBVUgsR0FBR1gsS0FBYixFQUFxQixJQUFJSSxLQUFLQyxLQUFLVSxNQUFMLEtBQWdCWCxDQUF6QixFQUE0QjtBQUFRO0FBQUUsS0FBdkosQ0FBd0osT0FBT1ksR0FBUCxFQUFZO0FBQUVULFdBQUssSUFBTCxDQUFXQyxLQUFLUSxHQUFMO0FBQVcsS0FBNUwsU0FBcU07QUFBRSxVQUFJO0FBQUUsWUFBSSxDQUFDVixFQUFELElBQU9JLEdBQUcsUUFBSCxDQUFYLEVBQXlCQSxHQUFHLFFBQUg7QUFBaUIsT0FBaEQsU0FBeUQ7QUFBRSxZQUFJSCxFQUFKLEVBQVEsTUFBTUMsRUFBTjtBQUFXO0FBQUUsS0FBQyxPQUFPSCxJQUFQO0FBQWMsR0FBQyxPQUFPLFVBQVVGLEdBQVYsRUFBZUMsQ0FBZixFQUFrQjtBQUFFLFFBQUlh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QUFsQyxDQUE1Sjs7QUFFQSxXQUFPL0MsU0FBUyxFQUFULEVBQWFvRCxpQkFBYixFQUFnQ3BCLGdCQUFnQixFQUFoQixFQUFvQixDQUFDLEdBQUdqQixZQUFZUCxPQUFoQixFQUF5QjZDLElBQXpCLENBQXBCLEVBQW9EQyxhQUFwRCxDQUFoQyxDQUFQO0FBQ0QsR0FMTSxFQUtKLEVBTEksQ0FBUDtBQU1EOztBQUVELFNBQVNYLG1CQUFULENBQTZCSCxlQUE3QixFQUE4QztBQUM1QyxTQUFPSyxlQUFlTCxnQkFBZ0JnQixNQUFoQixDQUF1QixVQUFVbEIsVUFBVixFQUFzQm1CLFVBQXRCLEVBQWtDO0FBQzdFLFdBQU96RCxTQUFTLEVBQVQsRUFBYXNDLFVBQWIsRUFBeUJOLGdCQUFnQixFQUFoQixFQUFvQnlCLFVBQXBCLEVBQWdDN0MsV0FBV0osT0FBM0MsQ0FBekIsQ0FBUDtBQUNELEdBRnFCLEVBRW5CLEVBRm1CLENBQWYsQ0FBUDtBQUdEIiwiZmlsZSI6InVua25vd24iLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbnZhciBfc2xpY2VkVG9BcnJheSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gc2xpY2VJdGVyYXRvcihhcnIsIGkpIHsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfZSA9IHVuZGVmaW5lZDsgdHJ5IHsgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgeyBfYXJyLnB1c2goX3MudmFsdWUpOyBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7IH0gfSBjYXRjaCAoZXJyKSB7IF9kID0gdHJ1ZTsgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgX2lbXCJyZXR1cm5cIl0pIF9pW1wicmV0dXJuXCJdKCk7IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfSByZXR1cm4gZnVuY3Rpb24gKGFyciwgaSkgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IHJldHVybiBhcnI7IH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7IHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7IH0gZWxzZSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlXCIpOyB9IH07IH0oKTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gY3JlYXRlQWN0aW9ucztcblxudmFyIF9pZGVudGl0eSA9IHJlcXVpcmUoJ2xvZGFzaC9pZGVudGl0eScpO1xuXG52YXIgX2lkZW50aXR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lkZW50aXR5KTtcblxudmFyIF9jYW1lbENhc2UgPSByZXF1aXJlKCdsb2Rhc2gvY2FtZWxDYXNlJyk7XG5cbnZhciBfY2FtZWxDYXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NhbWVsQ2FzZSk7XG5cbnZhciBfaXNQbGFpbk9iamVjdCA9IHJlcXVpcmUoJ2xvZGFzaC9pc1BsYWluT2JqZWN0Jyk7XG5cbnZhciBfaXNQbGFpbk9iamVjdDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pc1BsYWluT2JqZWN0KTtcblxudmFyIF9pc0FycmF5ID0gcmVxdWlyZSgnbG9kYXNoL2lzQXJyYXknKTtcblxudmFyIF9pc0FycmF5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lzQXJyYXkpO1xuXG52YXIgX3JlZHVjZSA9IHJlcXVpcmUoJ2xvZGFzaC9yZWR1Y2UnKTtcblxudmFyIF9yZWR1Y2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcmVkdWNlKTtcblxudmFyIF9pc1N0cmluZyA9IHJlcXVpcmUoJ2xvZGFzaC9pc1N0cmluZycpO1xuXG52YXIgX2lzU3RyaW5nMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lzU3RyaW5nKTtcblxudmFyIF9pc0Z1bmN0aW9uID0gcmVxdWlyZSgnbG9kYXNoL2lzRnVuY3Rpb24nKTtcblxudmFyIF9pc0Z1bmN0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lzRnVuY3Rpb24pO1xuXG52YXIgX2NyZWF0ZUFjdGlvbiA9IHJlcXVpcmUoJy4vY3JlYXRlQWN0aW9uJyk7XG5cbnZhciBfY3JlYXRlQWN0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NyZWF0ZUFjdGlvbik7XG5cbnZhciBfaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbnZhciBfaW52YXJpYW50MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2ludmFyaWFudCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gZWxzZSB7IHJldHVybiBBcnJheS5mcm9tKGFycik7IH0gfVxuXG5mdW5jdGlvbiBjcmVhdGVBY3Rpb25zKGFjdGlvbnNNYXApIHtcbiAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGlkZW50aXR5QWN0aW9ucyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBpZGVudGl0eUFjdGlvbnNbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldO1xuICB9XG5cbiAgKDAsIF9pbnZhcmlhbnQyLmRlZmF1bHQpKGlkZW50aXR5QWN0aW9ucy5ldmVyeShfaXNTdHJpbmcyLmRlZmF1bHQpICYmICgoMCwgX2lzU3RyaW5nMi5kZWZhdWx0KShhY3Rpb25zTWFwKSB8fCAoMCwgX2lzUGxhaW5PYmplY3QyLmRlZmF1bHQpKGFjdGlvbnNNYXApKSwgJ0V4cGVjdGVkIG9wdGlvbmFsIG9iamVjdCBmb2xsb3dlZCBieSBzdHJpbmcgYWN0aW9uIHR5cGVzJyk7XG4gIGlmICgoMCwgX2lzU3RyaW5nMi5kZWZhdWx0KShhY3Rpb25zTWFwKSkge1xuICAgIHJldHVybiBmcm9tSWRlbnRpdHlBY3Rpb25zKFthY3Rpb25zTWFwXS5jb25jYXQoaWRlbnRpdHlBY3Rpb25zKSk7XG4gIH1cbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBmcm9tQWN0aW9uc01hcChhY3Rpb25zTWFwKSwgZnJvbUlkZW50aXR5QWN0aW9ucyhpZGVudGl0eUFjdGlvbnMpKTtcbn1cblxuZnVuY3Rpb24gaXNWYWxpZEFjdGlvbnNNYXBWYWx1ZShhY3Rpb25zTWFwVmFsdWUpIHtcbiAgaWYgKCgwLCBfaXNGdW5jdGlvbjIuZGVmYXVsdCkoYWN0aW9uc01hcFZhbHVlKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2UgaWYgKCgwLCBfaXNBcnJheTIuZGVmYXVsdCkoYWN0aW9uc01hcFZhbHVlKSkge1xuICAgIHZhciBfYWN0aW9uc01hcFZhbHVlID0gX3NsaWNlZFRvQXJyYXkoYWN0aW9uc01hcFZhbHVlLCAyKTtcblxuICAgIHZhciBfYWN0aW9uc01hcFZhbHVlJCA9IF9hY3Rpb25zTWFwVmFsdWVbMF07XG4gICAgdmFyIHBheWxvYWQgPSBfYWN0aW9uc01hcFZhbHVlJCA9PT0gdW5kZWZpbmVkID8gX2lkZW50aXR5Mi5kZWZhdWx0IDogX2FjdGlvbnNNYXBWYWx1ZSQ7XG4gICAgdmFyIG1ldGEgPSBfYWN0aW9uc01hcFZhbHVlWzFdO1xuXG5cbiAgICByZXR1cm4gKDAsIF9pc0Z1bmN0aW9uMi5kZWZhdWx0KShwYXlsb2FkKSAmJiAoMCwgX2lzRnVuY3Rpb24yLmRlZmF1bHQpKG1ldGEpO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZnJvbUFjdGlvbnNNYXAoYWN0aW9uc01hcCkge1xuICByZXR1cm4gKDAsIF9yZWR1Y2UyLmRlZmF1bHQpKGFjdGlvbnNNYXAsIGZ1bmN0aW9uIChhY3Rpb25DcmVhdG9yc01hcCwgYWN0aW9uc01hcFZhbHVlLCB0eXBlKSB7XG4gICAgKDAsIF9pbnZhcmlhbnQyLmRlZmF1bHQpKGlzVmFsaWRBY3Rpb25zTWFwVmFsdWUoYWN0aW9uc01hcFZhbHVlKSwgJ0V4cGVjdGVkIGZ1bmN0aW9uLCB1bmRlZmluZWQsIG9yIGFycmF5IHdpdGggcGF5bG9hZCBhbmQgbWV0YSAnICsgKCdmdW5jdGlvbnMgZm9yICcgKyB0eXBlKSk7XG4gICAgdmFyIGFjdGlvbkNyZWF0b3IgPSAoMCwgX2lzQXJyYXkyLmRlZmF1bHQpKGFjdGlvbnNNYXBWYWx1ZSkgPyBfY3JlYXRlQWN0aW9uMi5kZWZhdWx0LmFwcGx5KHVuZGVmaW5lZCwgW3R5cGVdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoYWN0aW9uc01hcFZhbHVlKSkpIDogKDAsIF9jcmVhdGVBY3Rpb24yLmRlZmF1bHQpKHR5cGUsIGFjdGlvbnNNYXBWYWx1ZSk7XG5cbiAgICByZXR1cm4gX2V4dGVuZHMoe30sIGFjdGlvbkNyZWF0b3JzTWFwLCBfZGVmaW5lUHJvcGVydHkoe30sICgwLCBfY2FtZWxDYXNlMi5kZWZhdWx0KSh0eXBlKSwgYWN0aW9uQ3JlYXRvcikpO1xuICB9LCB7fSk7XG59XG5cbmZ1bmN0aW9uIGZyb21JZGVudGl0eUFjdGlvbnMoaWRlbnRpdHlBY3Rpb25zKSB7XG4gIHJldHVybiBmcm9tQWN0aW9uc01hcChpZGVudGl0eUFjdGlvbnMucmVkdWNlKGZ1bmN0aW9uIChhY3Rpb25zTWFwLCBhY3Rpb25UeXBlKSB7XG4gICAgcmV0dXJuIF9leHRlbmRzKHt9LCBhY3Rpb25zTWFwLCBfZGVmaW5lUHJvcGVydHkoe30sIGFjdGlvblR5cGUsIF9pZGVudGl0eTIuZGVmYXVsdCkpO1xuICB9LCB7fSkpO1xufSJdfQ==