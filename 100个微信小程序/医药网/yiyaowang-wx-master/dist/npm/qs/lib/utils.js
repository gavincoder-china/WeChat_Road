"use strict";var exports=module.exports={};
var _keys = require('../../babel-runtime/core-js/object/keys.js');

var _keys2 = _interopRequireDefault(_keys);

var _typeof2 = require('../../babel-runtime/helpers/typeof.js');

var _typeof3 = _interopRequireDefault(_typeof2);

var _create = require('../../babel-runtime/core-js/object/create.js');

var _create2 = _interopRequireDefault(_create);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var has = Object.prototype.hasOwnProperty;

var hexTable = function () {
    var array = [];
    for (var i = 0; i < 256; ++i) {
        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());
    }

    return array;
}();

exports.arrayToObject = function (source, options) {
    var obj = options && options.plainObjects ? (0, _create2.default)(null) : {};
    for (var i = 0; i < source.length; ++i) {
        if (typeof source[i] !== 'undefined') {
            obj[i] = source[i];
        }
    }

    return obj;
};

exports.merge = function (target, source, options) {
    if (!source) {
        return target;
    }

    if ((typeof source === 'undefined' ? 'undefined' : (0, _typeof3.default)(source)) !== 'object') {
        if (Array.isArray(target)) {
            target.push(source);
        } else if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) === 'object') {
            target[source] = true;
        } else {
            return [target, source];
        }

        return target;
    }

    if ((typeof target === 'undefined' ? 'undefined' : (0, _typeof3.default)(target)) !== 'object') {
        return [target].concat(source);
    }

    var mergeTarget = target;
    if (Array.isArray(target) && !Array.isArray(source)) {
        mergeTarget = exports.arrayToObject(target, options);
    }

    if (Array.isArray(target) && Array.isArray(source)) {
        source.forEach(function (item, i) {
            if (has.call(target, i)) {
                if (target[i] && (0, _typeof3.default)(target[i]) === 'object') {
                    target[i] = exports.merge(target[i], item, options);
                } else {
                    target.push(item);
                }
            } else {
                target[i] = item;
            }
        });
        return target;
    }

    return (0, _keys2.default)(source).reduce(function (acc, key) {
        var value = source[key];

        if (Object.prototype.hasOwnProperty.call(acc, key)) {
            acc[key] = exports.merge(acc[key], value, options);
        } else {
            acc[key] = value;
        }
        return acc;
    }, mergeTarget);
};

exports.decode = function (str) {
    try {
        return decodeURIComponent(str.replace(/\+/g, ' '));
    } catch (e) {
        return str;
    }
};

exports.encode = function (str) {
    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.
    // It has been adapted here for stricter adherence to RFC 3986
    if (str.length === 0) {
        return str;
    }

    var string = typeof str === 'string' ? str : String(str);

    var out = '';
    for (var i = 0; i < string.length; ++i) {
        var c = string.charCodeAt(i);

        if (c === 0x2D || // -
        c === 0x2E || // .
        c === 0x5F || // _
        c === 0x7E || // ~
        c >= 0x30 && c <= 0x39 || // 0-9
        c >= 0x41 && c <= 0x5A || // a-z
        c >= 0x61 && c <= 0x7A // A-Z
        ) {
                out += string.charAt(i);
                continue;
            }

        if (c < 0x80) {
            out = out + hexTable[c];
            continue;
        }

        if (c < 0x800) {
            out = out + (hexTable[0xC0 | c >> 6] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        if (c < 0xD800 || c >= 0xE000) {
            out = out + (hexTable[0xE0 | c >> 12] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F]);
            continue;
        }

        i += 1;
        c = 0x10000 + ((c & 0x3FF) << 10 | string.charCodeAt(i) & 0x3FF);
        out += hexTable[0xF0 | c >> 18] + hexTable[0x80 | c >> 12 & 0x3F] + hexTable[0x80 | c >> 6 & 0x3F] + hexTable[0x80 | c & 0x3F];
    }

    return out;
};

exports.compact = function (obj, references) {
    if ((typeof obj === 'undefined' ? 'undefined' : (0, _typeof3.default)(obj)) !== 'object' || obj === null) {
        return obj;
    }

    var refs = references || [];
    var lookup = refs.indexOf(obj);
    if (lookup !== -1) {
        return refs[lookup];
    }

    refs.push(obj);

    if (Array.isArray(obj)) {
        var compacted = [];

        for (var i = 0; i < obj.length; ++i) {
            if (obj[i] && (0, _typeof3.default)(obj[i]) === 'object') {
                compacted.push(exports.compact(obj[i], refs));
            } else if (typeof obj[i] !== 'undefined') {
                compacted.push(obj[i]);
            }
        }

        return compacted;
    }

    var keys = (0, _keys2.default)(obj);
    keys.forEach(function (key) {
        obj[key] = exports.compact(obj[key], refs);
    });

    return obj;
};

exports.isRegExp = function (obj) {
    return Object.prototype.toString.call(obj) === '[object RegExp]';
};

exports.isBuffer = function (obj) {
    if (obj === null || typeof obj === 'undefined') {
        return false;
    }

    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImhhcyIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiaGV4VGFibGUiLCJhcnJheSIsImkiLCJwdXNoIiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImV4cG9ydHMiLCJhcnJheVRvT2JqZWN0Iiwic291cmNlIiwib3B0aW9ucyIsIm9iaiIsInBsYWluT2JqZWN0cyIsImxlbmd0aCIsIm1lcmdlIiwidGFyZ2V0IiwiQXJyYXkiLCJpc0FycmF5IiwiY29uY2F0IiwibWVyZ2VUYXJnZXQiLCJmb3JFYWNoIiwiaXRlbSIsImNhbGwiLCJyZWR1Y2UiLCJhY2MiLCJrZXkiLCJ2YWx1ZSIsImRlY29kZSIsInN0ciIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlcGxhY2UiLCJlIiwiZW5jb2RlIiwic3RyaW5nIiwiU3RyaW5nIiwib3V0IiwiYyIsImNoYXJDb2RlQXQiLCJjaGFyQXQiLCJjb21wYWN0IiwicmVmZXJlbmNlcyIsInJlZnMiLCJsb29rdXAiLCJpbmRleE9mIiwiY29tcGFjdGVkIiwia2V5cyIsImlzUmVnRXhwIiwiaXNCdWZmZXIiLCJjb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFJQSxNQUFNQyxPQUFPQyxTQUFQLENBQWlCQyxjQUEzQjs7QUFFQSxJQUFJQyxXQUFZLFlBQVk7QUFDeEIsUUFBSUMsUUFBUSxFQUFaO0FBQ0EsU0FBSyxJQUFJQyxJQUFJLENBQWIsRUFBZ0JBLElBQUksR0FBcEIsRUFBeUIsRUFBRUEsQ0FBM0IsRUFBOEI7QUFDMUJELGNBQU1FLElBQU4sQ0FBVyxNQUFNLENBQUMsQ0FBQ0QsSUFBSSxFQUFKLEdBQVMsR0FBVCxHQUFlLEVBQWhCLElBQXNCQSxFQUFFRSxRQUFGLENBQVcsRUFBWCxDQUF2QixFQUF1Q0MsV0FBdkMsRUFBakI7QUFDSDs7QUFFRCxXQUFPSixLQUFQO0FBQ0gsQ0FQZSxFQUFoQjs7QUFTQUssUUFB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LElBQWdCLE9BQU9BLEdBQVAsS0FBZSxXQUFuQyxFQUFnRDtBQUM1QyxlQUFPLEtBQVA7QUFDSDs7QUFFRCxXQUFPLENBQUMsRUFBRUEsSUFBSXFDLFdBQUosSUFBbUJyQyxJQUFJcUMsV0FBSixDQUFnQkQsUUFBbkMsSUFBK0NwQyxJQUFJcUMsV0FBSixDQUFnQkQsUUFBaEIsQ0FBeUJwQyxHQUF6QixDQUFqRCxDQUFSO0FBQ0gsQ0FORCIsImZpbGUiOiJ1bmtub3duIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcblxudmFyIGhleFRhYmxlID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgKytpKSB7XG4gICAgICAgIGFycmF5LnB1c2goJyUnICsgKChpIDwgMTYgPyAnMCcgOiAnJykgKyBpLnRvU3RyaW5nKDE2KSkudG9VcHBlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xufSgpKTtcblxuZXhwb3J0cy5hcnJheVRvT2JqZWN0ID0gZnVuY3Rpb24gKHNvdXJjZSwgb3B0aW9ucykge1xuICAgIHZhciBvYmogPSBvcHRpb25zICYmIG9wdGlvbnMucGxhaW5PYmplY3RzID8gT2JqZWN0LmNyZWF0ZShudWxsKSA6IHt9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlW2ldICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgb2JqW2ldID0gc291cmNlW2ldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9iajtcbn07XG5cbmV4cG9ydHMubWVyZ2UgPSBmdW5jdGlvbiAodGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHtcbiAgICBpZiAoIXNvdXJjZSkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygc291cmNlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSB7XG4gICAgICAgICAgICB0YXJnZXQucHVzaChzb3VyY2UpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB0YXJnZXRbc291cmNlXSA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW3RhcmdldCwgc291cmNlXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0YXJnZXQgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBbdGFyZ2V0XS5jb25jYXQoc291cmNlKTtcbiAgICB9XG5cbiAgICB2YXIgbWVyZ2VUYXJnZXQgPSB0YXJnZXQ7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSAmJiAhQXJyYXkuaXNBcnJheShzb3VyY2UpKSB7XG4gICAgICAgIG1lcmdlVGFyZ2V0ID0gZXhwb3J0cy5hcnJheVRvT2JqZWN0KHRhcmdldCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodGFyZ2V0KSAmJiBBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAgICAgc291cmNlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGkpIHtcbiAgICAgICAgICAgIGlmIChoYXMuY2FsbCh0YXJnZXQsIGkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldFtpXSAmJiB0eXBlb2YgdGFyZ2V0W2ldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRbaV0gPSBleHBvcnRzLm1lcmdlKHRhcmdldFtpXSwgaXRlbSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbaV0gPSBpdGVtO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmtleXMoc291cmNlKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHNvdXJjZVtrZXldO1xuXG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYWNjLCBrZXkpKSB7XG4gICAgICAgICAgICBhY2Nba2V5XSA9IGV4cG9ydHMubWVyZ2UoYWNjW2tleV0sIHZhbHVlLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFjY1trZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCBtZXJnZVRhcmdldCk7XG59O1xuXG5leHBvcnRzLmRlY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0ci5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cbn07XG5cbmV4cG9ydHMuZW5jb2RlID0gZnVuY3Rpb24gKHN0cikge1xuICAgIC8vIFRoaXMgY29kZSB3YXMgb3JpZ2luYWxseSB3cml0dGVuIGJ5IEJyaWFuIFdoaXRlIChtc2NkZXgpIGZvciB0aGUgaW8uanMgY29yZSBxdWVyeXN0cmluZyBsaWJyYXJ5LlxuICAgIC8vIEl0IGhhcyBiZWVuIGFkYXB0ZWQgaGVyZSBmb3Igc3RyaWN0ZXIgYWRoZXJlbmNlIHRvIFJGQyAzOTg2XG4gICAgaWYgKHN0ci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG5cbiAgICB2YXIgc3RyaW5nID0gdHlwZW9mIHN0ciA9PT0gJ3N0cmluZycgPyBzdHIgOiBTdHJpbmcoc3RyKTtcblxuICAgIHZhciBvdXQgPSAnJztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cmluZy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgYyA9IHN0cmluZy5jaGFyQ29kZUF0KGkpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGMgPT09IDB4MkQgfHwgLy8gLVxuICAgICAgICAgICAgYyA9PT0gMHgyRSB8fCAvLyAuXG4gICAgICAgICAgICBjID09PSAweDVGIHx8IC8vIF9cbiAgICAgICAgICAgIGMgPT09IDB4N0UgfHwgLy8gflxuICAgICAgICAgICAgKGMgPj0gMHgzMCAmJiBjIDw9IDB4MzkpIHx8IC8vIDAtOVxuICAgICAgICAgICAgKGMgPj0gMHg0MSAmJiBjIDw9IDB4NUEpIHx8IC8vIGEtelxuICAgICAgICAgICAgKGMgPj0gMHg2MSAmJiBjIDw9IDB4N0EpIC8vIEEtWlxuICAgICAgICApIHtcbiAgICAgICAgICAgIG91dCArPSBzdHJpbmcuY2hhckF0KGkpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYyA8IDB4ODApIHtcbiAgICAgICAgICAgIG91dCA9IG91dCArIGhleFRhYmxlW2NdO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYyA8IDB4ODAwKSB7XG4gICAgICAgICAgICBvdXQgPSBvdXQgKyAoaGV4VGFibGVbMHhDMCB8IChjID4+IDYpXSArIGhleFRhYmxlWzB4ODAgfCAoYyAmIDB4M0YpXSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjIDwgMHhEODAwIHx8IGMgPj0gMHhFMDAwKSB7XG4gICAgICAgICAgICBvdXQgPSBvdXQgKyAoaGV4VGFibGVbMHhFMCB8IChjID4+IDEyKV0gKyBoZXhUYWJsZVsweDgwIHwgKChjID4+IDYpICYgMHgzRildICsgaGV4VGFibGVbMHg4MCB8IChjICYgMHgzRildKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaSArPSAxO1xuICAgICAgICBjID0gMHgxMDAwMCArICgoKGMgJiAweDNGRikgPDwgMTApIHwgKHN0cmluZy5jaGFyQ29kZUF0KGkpICYgMHgzRkYpKTtcbiAgICAgICAgb3V0ICs9IGhleFRhYmxlWzB4RjAgfCAoYyA+PiAxOCldICsgaGV4VGFibGVbMHg4MCB8ICgoYyA+PiAxMikgJiAweDNGKV0gKyBoZXhUYWJsZVsweDgwIHwgKChjID4+IDYpICYgMHgzRildICsgaGV4VGFibGVbMHg4MCB8IChjICYgMHgzRildO1xuICAgIH1cblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG5leHBvcnRzLmNvbXBhY3QgPSBmdW5jdGlvbiAob2JqLCByZWZlcmVuY2VzKSB7XG4gICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIHZhciByZWZzID0gcmVmZXJlbmNlcyB8fCBbXTtcbiAgICB2YXIgbG9va3VwID0gcmVmcy5pbmRleE9mKG9iaik7XG4gICAgaWYgKGxvb2t1cCAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHJlZnNbbG9va3VwXTtcbiAgICB9XG5cbiAgICByZWZzLnB1c2gob2JqKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICAgICAgdmFyIGNvbXBhY3RlZCA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAob2JqW2ldICYmIHR5cGVvZiBvYmpbaV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgY29tcGFjdGVkLnB1c2goZXhwb3J0cy5jb21wYWN0KG9ialtpXSwgcmVmcykpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW2ldICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGNvbXBhY3RlZC5wdXNoKG9ialtpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29tcGFjdGVkO1xuICAgIH1cblxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBvYmpba2V5XSA9IGV4cG9ydHMuY29tcGFjdChvYmpba2V5XSwgcmVmcyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gb2JqO1xufTtcblxuZXhwb3J0cy5pc1JlZ0V4cCA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IFJlZ0V4cF0nO1xufTtcblxuZXhwb3J0cy5pc0J1ZmZlciA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gISEob2JqLmNvbnN0cnVjdG9yICYmIG9iai5jb25zdHJ1Y3Rvci5pc0J1ZmZlciAmJiBvYmouY29uc3RydWN0b3IuaXNCdWZmZXIob2JqKSk7XG59O1xuIl19